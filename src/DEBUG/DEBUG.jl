using Revise
using InPhyNet, PhyloNetworks, CSV, DataFrames

constraints = [readTopology(c) for c in split("((t151:1.116000485,((t153:0.9161998422,t154:0.9161998422):0.1247197647,#H16:0.3050694379::0.4969438154):0.07508087826):0.6426592856,((((((t172:0.02170188522,t173:0.02170188522):0.2751759536,t165:0.2968778388):0.2693292908,((t171:0.03461384533)#H17:0.0::0.6947316733,(t170:0.03461384533,t158:0.504326298):0.4697124526):0.06188083163):0.01616341976,(t161:0.3251591612,t162:0.3251591612):0.2572113881):0.3317263693,t155:0.9140969187):0.6424449391,((t159:0.4020547204,t160:0.4020547204):1.152655638,(((t156:0.5545873721,t157:0.5545873721):0.450180329,(t152:1.011022898,(((t163:0.3153349737,t164:0.3153349737):0.4205151954)#H16:0.0::0.5030561846,(t174:0.0112545297,t175:0.0112545297):0.7245956394):0.2689175321):0.006255197101):0.3573964181,(t166:0.1743888496,(t167:0.1547504909,((t169:0.03461384533,#H17:0.0::0.3052683267):0.07809321044,t168:0.1127070558):0.04204343513):0.01963835871):1.194030467):0.1862910417):0.001831499777):0.202117913);
((t176:3.075827678,((((t197:0.08256378639,t198:0.08256378639):0.8524134764,(t181:0.9349772628)#H18:0.0::0.6223725083):0.5152434941,((t185:0.5156071193,t186:0.5156071193):0.7648474554,#H19:0.0::0.3402192055):0.1697661823):0.3917357457,((t199:0.06085301682,t200:0.06085301682):0.5562984604,t182:0.6171514772):1.224805025):1.233871176):0.1384811412,(((t188:0.4528158819,t189:0.4528158819):1.968094905,(((t177:1.280454575,(((t192:0.2455714726,#H20:0.0::0.4111215432):0.6162103664,(t195:0.23072442,t196:0.23072442):0.6310574191):0.4186727356)#H19:0.0::0.6597807945):0.6673465111,(t178:1.020730722,t179:1.020730722):0.6263414561):0.3007289074,(t183:0.6155518825,(t190:0.3820059929,t191:0.3820059929):0.2335458896):1.031520296):0.4731097014):0.4819558583,((t180:0.9349772628,#H18:0.0::0.3776274917):1.918846118,((t187:0.4919614536,(t193:0.2455714726,(t194:0.2455714726)#H20:0.0::0.5888784568):0.246389981):0.02658683078,t184:0.5185482844):2.335275096):0.04904326504):0.3114421741);
((t35:0.3269890338,((t43:0.1195437122,#H4:0.01283040855::0.4635265014):0.1412854409,(t42:0.260829153)#H5:0.0::0.6680510572):0.06615988077):1.838666395,(((((((t32:0.4044529413,(((((((t49:0.05858762787,t50:0.05858762787):0.2103279292)#H6:0.0::0.6061165576,t40:0.2689155571):0.0156071836,t39:0.2845227407):0.009113950653,t36:0.2936366913):0.1163723398,(t45:0.1067133036,(t44:0.1067133036,(t46:0.1067133036)#H4:0.0::0.5364734986):0.0):0.3032957275):0.106994035,t31:0.4044529413):0.1125501248):0.1611924207,t29:0.6781954868):0.2411693743,(t37:0.2883228704,t38:0.2883228704):0.4173833611):0.2136586295,((t47:0.08894681059,t48:0.08894681059):0.4085381711,t30:0.4974849816):0.2082212499):0.2123200005,((t41:0.260829153,#H5:0.0::0.3319489428):0.7757261127,t26:1.036555266):0.09512959594):0.07773473306,((t33:0.3626210294,t34:0.3626210294):0.5770988084,(t27:0.7334850141,t28:0.7334850141):0.2062348238):1.093253178):0.8235534211,#H6:0.9405040376::0.3938834424):0.1326824125);
(((((t56:0.6113396476,t59:0.3778743104):0.2334653372,((t55:0.6554668787,((t60:0.3589107131,(t62:0.1727287894,t63:0.1727287894):0.1861819238):0.05020890035,t58:0.4091196135):0.2463472652):0.07770760088,(t64:0.1429924292,t65:0.1429924292):0.2348818812):0.121834832):0.5375372617,(t51:1.466732239,(t70:0.1063656267,((t66:0.1301204151,t67:0.1301204151):0.8409648697,t71:0.1063656267):0.8647196581):0.2996264565):0.1960204981):0.276045255,(t53:0.7358957327,(t52:1.32370397,(t54:0.6935843404,((t68:0.1210627284,t69:0.1210627284):0.4065861888,t57:0.5276489171):0.1659354232):0.04231139227):0.5878082375):0.4190735242):0.4057828645,(t61:0.3573331453,(t73:0.08101202763,((t74:0.02691708965,t75:0.02691708965):0.06383907,t72:0.08101202763):0.009744132008):0.2665769856):1.791227214);
(((t104:0.8106643984)#H10:1.413161546::0.574152016,((((t101:1.190081511,(t115:0.1591624466,t116:0.1591624466):1.030919064):0.01551956785,(t105:0.8106643984,#H10:0.0::0.425847984):0.3949366805):0.3113760842,((t102:1.094150977,#H11:0.0::0.4750893545):0.3307213422,(t103:0.8660436204,(t119:0.09476184826,t120:0.09476184826):0.7712817721):0.558828699):0.09210484356):0.3481593855,(((t113:0.2301421184,t114:0.2301421184):0.2991782228,((t110:0.2848147154,((t122:0.02380634595)#H12:0.0::0.6632596681,t123:0.02380634595):0.2610083694):0.1476864922,t106:0.4325012076):0.09681913354):0.2476845023,(t107:0.4204838753,t108:0.4204838753):0.3565209682):1.088131705):0.3586893955):0.7966712281,(((t121:0.027323312,#H12:0.003516966051::0.3367403319):0.7841003026,(t111:0.2609028751,t112:0.2609028751):0.5505207395):0.2827273626,((((t124:0.006831395379,t125:0.006831395379):0.3985513444,t109:0.4053827398):0.3086338683,(t117:0.1245822991,t118:0.1245822991):0.589434309):0.3801343691)#H11:0.0::0.5249106455):1.926346195);
(((((t129:1.185941667,((t137:0.2174763869,(t139:0.2174763869)#H14:0.0::0.5679757147):0.3762056556,t131:0.5936820425):0.5922596243):0.5046163615,#H13:0.0::0.4171709032):0.1449710805,t126:1.545586948):0.2516453985,(((t135:0.2233103497,t136:0.2233103497):0.366841888,(t133:0.2374233439,t134:0.2374233439):0.3527288938):0.9554347101,(((((t138:0.2174763869,#H14:0.0::0.4320242853):0.2955706925,t132:0.5130470793):0.08755411622,t130:0.6006011956):0.1191577471,((t142:0.1781365672,t143:0.1781365672):0.06275028437,((t144:0.06576904416,(t146:0.06576904416)#H15:0.0::0.5994264794):0.5797189341,(t147:0.05750869102,t148:0.05750869102):0.1833781606):0.4046011266):0.07427096446):0.8258280051)#H13:0.0::0.5828290968):0.3966164791):0.6659387544,((t127:1.276037244,((t140:0.2126846092,t141:0.2126846092):0.9745657219,t128:1.187250331):0.08878691338):0.1432043971,(t149:0.04387661365,((t145:0.06576904416,#H15:0.0::0.4005735206):0.9819774311,t150:0.04387661365):1.003869862):0.3714951664):1.18890054);
((((t4:1.133167339,(t14:0.2433878357,t15:0.2433878357):0.8897795034):0.6475381068,(t3:1.267582802,((((t8:0.6275295053,(t10:0.3635345605,t11:0.3635345605):0.2639949448):0.1106869879,(t12:0.3558731046,t13:0.3558731046):0.3823433886):0.02050043864,t6:0.7587169318):0.1335706251,#H1:0.05905366612::0.4073980593):0.3752952453):0.5131226437):0.7328114717,((t16:0.1510474566,#H2:0.0::0.4151532386):1.471199357,(t2:1.295784148,((t9:0.5250596215,((t17:0.134343156,t18:0.134343156):0.3907164655,t7:0.6293825606):0.1043229391):0.6215729793,((((t20:0.0)#H3:0.0::0.5798279242,t19:0.1140175253):0.3010908478,#H3:0.3010908478::0.4201720758):0.08215489264,((t5:0.8332338908,(t22:0.1009744649,t21:0.0):0.732259426):0.0)#H1:0.3962888008::0.5926019407):0.7536922741):0.04482860816):0.3264626656):0.8912701041):0.2016865715,(((t23:0.07560211161,(t24:0.03243740192,t25:0.03243740192):0.04316470969):0.07544534495)#H2:1.367992853::0.5848467614,t1:1.51904031):1.19616318);
(((t80:0.8046540885,(t82:0.534239312,(t97:0.07162911489,(t92:0.1206829142,t98:0.07162911489):0.04905379934):0.4135563978):0.2704147766):0.08057371146,(t79:0.8703802094,(((t95:0.1019075258,t96:0.1019075258):0.1177449173,t88:0.2196524431):0.11422748469999999,(t83:0.3830941307,t84:0.3338799278):0.04921420291):0.4872860787):0.01484759059):0.2781999441,(t91:0.1392212672,(t93:0.1154893123,t94:0.1154893123):0.02373195493):1.024206477);
(OUTGROUP:1.0,((t76:1.212123027,t77:1.212123027):0.9325790545,(((((t89:0.165508945,t90:0.165508945):0.5376941593,(t85:0.2447987026,(t86:0.2357937442,t87:0.2357937442):0.009004958323):0.4584044017):0.04221275404,(t99:0.02907212963,t100:0.02907212963):0.6852439206000001):0.03109980807,t81:0.7143160502):0.4834061158,t78:1.22882197439):0.9158801072));", "\n")]

truenet = readTopology("(((((((t151:1.116000485,((t153:0.9161998422,t154:0.9161998422):0.1247197647,#H16:0.3050694379::0.4969438154):0.07508087826):0.6426592856,((((((t172:0.02170188522,t173:0.02170188522):0.2751759536,t165:0.2968778388):0.2693292908,(t158:0.504326298,(t170:0.03461384533,(t171:0.03461384533)#H17:0.0::0.6947316733):0.4697124526):0.06188083163):0.01616341976,(t161:0.3251591612,t162:0.3251591612):0.2572113881):0.3317263693,t155:0.9140969187):0.6424449391,((t159:0.4020547204,t160:0.4020547204):1.152655638,((((((t163:0.3153349737,t164:0.3153349737):0.4205151954)#H16:0.0::0.5030561846,(t174:0.0112545297,t175:0.0112545297):0.7245956394):0.2689175321,(t156:0.5545873721,t157:0.5545873721):0.450180329):0.006255197101,t152:1.011022898):0.3573964181,(t166:0.1743888496,(t167:0.1547504909,((t169:0.03461384533,#H17:0.0::0.3052683267):0.07809321044,t168:0.1127070558):0.04204343513):0.01963835871):1.194030467):0.1862910417):0.001831499777):0.202117913):0.0901433342,((t176:3.075827678,((((t197:0.08256378639,t198:0.08256378639):0.8524134764,(t181:0.9349772628)#H18:0.0::0.6223725083):0.5152434941,((t185:0.5156071193,t186:0.5156071193):0.7648474554,#H19:0.0::0.3402192055):0.1697661823):0.3917357457,((t199:0.06085301682,t200:0.06085301682):0.5562984604,t182:0.6171514772):1.224805025):1.233871176):0.1384811412,(((t188:0.4528158819,t189:0.4528158819):1.968094905,(((t183:0.6155518825,(t190:0.3820059929,t191:0.3820059929):0.2335458896):1.031520296,(t178:1.020730722,t179:1.020730722):0.6263414561):0.3007289074,(t177:1.280454575,(((t192:0.2455714726,#H20:0.0::0.4111215432):0.6162103664,(t195:0.23072442,t196:0.23072442):0.6310574191):0.4186727356)#H19:0.0::0.6597807945):0.6673465111):0.4731097014):0.4819558583,((t180:0.9349772628,#H18:0.0::0.3776274917):1.918846118,((t187:0.4919614536,(t193:0.2455714726,(t194:0.2455714726)#H20:0.0::0.5888784568):0.246389981):0.02658683078,t184:0.5185482844):2.335275096):0.04904326504):0.3114421741):0.0901433342):0.6276513308,(((t35:0.3269890338,((t43:0.1195437122,(t44:0.1067133036,(t46:0.1067133036)#H4:0.0::0.5364734986):0.01283040855):0.1412854409,(t42:0.260829153)#H5:0.0::0.6680510572):0.06615988077):1.838666395,(((((((t47:0.08894681059,t48:0.08894681059):0.4085381711,t30:0.4974849816):0.2082212499,(t37:0.2883228704,t38:0.2883228704):0.4173833611):0.2136586295,((((((((t49:0.05858762787,t50:0.05858762787):0.2103279292)#H6:0.0::0.6061165576,t40:0.2689155571):0.0156071836,t39:0.2845227407):0.009113950653,t36:0.2936366913):0.1163723398,(t45:0.1067133036,#H4:0.0::0.4635265014):0.3032957275):0.106994035,(t31:0.4044529413,t32:0.4044529413):0.1125501248):0.1611924207,t29:0.6781954868):0.2411693743):0.2123200005,((t41:0.260829153,#H5:0.0::0.3319489428):0.7757261127,t26:1.036555266):0.09512959594):0.07773473306,#H6:0.9405040376::0.3938834424):0.8235534211,((t33:0.3626210294,t34:0.3626210294):0.5770988084,(t27:0.7334850141,t28:0.7334850141):0.2062348238):1.093253178):0.1326824125):0.5398078823,(((((((t70:0.1063656267,t71:0.1063656267):0.8647196581,(t66:0.1301204151,t67:0.1301204151):0.8409648697):0.2996264565,((t56:0.6113396476,((t64:0.1429924292,t65:0.1429924292):0.2348818812,t59:0.3778743104):0.2334653372):0.121834832,(t55:0.6554668787,((t60:0.3589107131,(t62:0.1727287894,t63:0.1727287894):0.1861819238):0.05020890035,t58:0.4091196135):0.2463472652):0.07770760088):0.5375372617):0.1960204981,t51:1.466732239):0.276045255,#H7:0.0::0.4163047487):0.4057828645,(t61:0.3573331453,((t72:0.08101202763,t73:0.08101202763):0.009744132008,(t74:0.02691708965,t75:0.02691708965):0.06383907):0.2665769856):1.791227214):0.1103439684,((((t54:0.6935843404,((t68:0.1210627284,t69:0.1210627284):0.4065861888,t57:0.5276489171):0.1659354232):0.04231139227,t53:0.7358957327):0.5878082375,t52:1.32370397):0.4190735242)#H7:0.5161268329::0.5836952513):0.5398078823):0.1779867827):0.8963737469,((((t4:1.133167339,(t14:0.2433878357,t15:0.2433878357):0.8897795034):0.6475381068,(t3:1.267582802,((((t8:0.6275295053,(t10:0.3635345605,t11:0.3635345605):0.2639949448):0.1106869879,(t12:0.3558731046,t13:0.3558731046):0.3823433886):0.02050043864,t6:0.7587169318):0.1335706251,((t22:0.1009744649,#H1:0.0::0.4073980593):0.732259426,t5:0.8332338908):0.05905366612):0.3752952453):0.5131226437):0.7328114717,(((t23:0.07560211161,(t24:0.03243740192,t25:0.03243740192):0.04316470969):0.07544534495)#H2:1.471199357::0.5848467614,(t2:1.295784148,((t7:0.6293825606,((t17:0.134343156,t18:0.134343156):0.3907164655,t9:0.5250596215):0.1043229391):0.6215729793,((((t19:0.1140175253)#H3:0.0::0.5798279242,t20:0.1140175253):0.3010908478,#H3:0.3010908478::0.4201720758):0.08215489264,(t21:0.1009744649)#H1:0.3962888008::0.5926019407):0.7536922741):0.04482860816):0.3264626656):0.8912701041):0.2016865715,((t16:0.1510474566,#H2:0.0::0.4151532386):1.367992853,t1:1.51904031):1.19616318):1.614168412):0.782491941,(((t76:1.212123027,t77:1.212123027):0.9325790545,((t78:1.181709003,(((t80:0.8046540885,(((t92:0.1206829142,(t97:0.07162911489,t98:0.07162911489):0.04905379934):0.4135563978)#H8:0.0::0.5612909553,t82:0.534239312):0.2704147766):0.08057371146,(t79:0.8703802094,(t83:0.3830941307,((((t95:0.1019075258,t96:0.1019075258):0.1177449173,t88:0.2196524431):0.01666151708)#H9:0.09756596762::0.6147520853,t84:0.3338799278):0.04921420291):0.4872860787):0.01484759059):0.2781999441,(t91:0.1392212672,(t93:0.1154893123,t94:0.1154893123):0.02373195493):1.024206477):0.01828125854):0.04711297139,((((t99:0.02907212963,t100:0.02907212963):0.2072418305,#H9:0.0::0.3852479147):0.4780020901,(t81:0.577608923,#H8:0.043369611::0.4387090447):0.1367071272):0.03109980807,((t89:0.165508945,t90:0.165508945):0.5376941593,(t85:0.2447987026,(t86:0.2357937442,t87:0.2357937442):0.009004958323):0.4584044017):0.04221275404):0.4834061158):0.9158801072):0.418642512,((((t104:0.8106643984)#H10:1.413161546::0.574152016,((((t101:1.190081511,(t115:0.1591624466,t116:0.1591624466):1.030919064):0.01551956785,(t105:0.8106643984,#H10:0.0::0.425847984):0.3949366805):0.3113760842,((t102:1.094150977,#H11:0.0::0.4750893545):0.3307213422,(t103:0.8660436204,(t119:0.09476184826,t120:0.09476184826):0.7712817721):0.558828699):0.09210484356):0.3481593855,(((t113:0.2301421184,t114:0.2301421184):0.2991782228,((t110:0.2848147154,((t122:0.02380634595)#H12:0.0::0.6632596681,t123:0.02380634595):0.2610083694):0.1476864922,t106:0.4325012076):0.09681913354):0.2476845023,(t107:0.4204838753,t108:0.4204838753):0.3565209682):1.088131705):0.3586893955):0.7966712281,(((t121:0.027323312,#H12:0.003516966051::0.3367403319):0.7841003026,(t111:0.2609028751,t112:0.2609028751):0.5505207395):0.2827273626,((((t124:0.006831395379,t125:0.006831395379):0.3985513444,t109:0.4053827398):0.3086338683,(t117:0.1245822991,t118:0.1245822991):0.589434309):0.3801343691)#H11:0.0::0.5249106455):1.926346195):0.2713711486,((((t126:1.545586948,#H13:0.0::0.4171709032):0.1449710805,(t129:1.185941667,((t137:0.2174763869,(t139:0.2174763869)#H14:0.0::0.5679757147):0.3762056556,t131:0.5936820425):0.5922596243):0.5046163615):0.2516453985,(((t135:0.2233103497,t136:0.2233103497):0.366841888,(t133:0.2374233439,t134:0.2374233439):0.3527288938):0.9554347101,(((((t138:0.2174763869,#H14:0.0::0.4320242853):0.2955706925,t132:0.5130470793):0.08755411622,t130:0.6006011956):0.1191577471,(((t142:0.1781365672,t143:0.1781365672):0.06275028437,(t147:0.05750869102,t148:0.05750869102):0.1833781606):0.4046011266,(t144:0.06576904416,(t146:0.06576904416)#H15:0.0::0.5994264794):0.5797189341):0.07427096446):0.8258280051)#H13:0.0::0.5828290968):0.3966164791):0.6659387544,((t127:1.276037244,((t140:0.2126846092,t141:0.2126846092):0.9745657219,t128:1.187250331):0.08878691338):0.1432043971,((t145:0.06576904416,#H15:0.0::0.4005735206):0.9819774311,(t149:0.04387661365,t150:0.04387661365):1.003869862):0.3714951664):1.18890054):0.2713711486):0.1472713634):1.978017841),OUTGROUP:1.0);")

_, namelist = majorinternodedistance(truenet)
D = Matrix(CSV.read("/mnt/dv/wid/projects4/SolisLemus-network-merging/dmat7.csv", DataFrame))
mnet = netnj(D, constraints, namelist)

using PhyloPlots
PhyloPlots.plot(constraints[1])





cc = readTopology("((A,(B,#H1)),(C)#H1);")
_, namelist = majorinternodecount(cc)
D = Matrix{Float64}([0. 2. 3.; 2. 0. 0.; 3. 0. 0.])
mnet = netnj(D, [cc], namelist)