using Revise
using InPhyNet, PhyloNetworks, CSV, DataFrames

constraints = [readTopology(c) for c in split("((((t56:0.4198231732,((t72:0.08480279492,t73:0.08480279492):0.3350203783)#H4:0.0::0.5927107882):1.141125203,(t55:0.4221967992,(t64:0.2473939322,t65:0.2473939322):0.174802867):1.138751577):0.165097794,((t74:0.02494319292,t75:0.02494319292):0.343425173,((#H4:0.0::0.4072892118,((t60:0.3281279794,t61:0.3281279794):0.09169519386,((t54:0.4642544649,(t68:0.1757050026,t69:0.1757050026):0.2885494623):0.7057635076,t51:1.170017972):0.07910449534):0.8292992946):0.3910061092,t59:0.3683683659):1.271760211):0.08591759313):1.444116608,((t52:0.9107015005,(t70:0.1302613159,t71:0.1302613159):0.7804401846):0.7772913367,((t62:0.2542254334,t63:0.2542254334):1.431866722,((t57:0.3790001775,t58:0.3790001775):1.139600672,(t53:0.535665894,(t66:0.2380711355,t67:0.2380711355):0.2975947585):0.9829349551):0.1674913061):0.001900682083):1.482169941);
((((((t92:0.1231955358,t93:0.1231955358):0.4537598567,(t83:0.2714159532,t84:0.2714159532):0.3055394393):0.5435278315,(t78:0.6872718197,t79:0.6872718197):0.4332114043):0.1336780598,t77:1.254161284):0.1232131407,(t76:1.292931397,(((t90:0.1690663621,t91:0.1690663621):0.1709390601,((t81:0.3125054383,t82:0.3125054383):0.00143089632,((t99:0.02800027315,t100:0.02800027315):0.08606093649,t94:0.1140612096):0.199875125):0.02606908751):0.1904480454,((t85:0.2489316268,t86:0.2489316268):0.09251823225,t80:0.3414498591):0.1890036085):0.7624779295):0.08444302737):0.5000505714,(((t88:0.1789034623,t89:0.1789034623):0.2956974678,(t97:0.05046667997,t98:0.05046667997):0.4241342502):0.01645616901,((t95:0.1089569553,t96:0.1089569553):0.08864468848,t87:0.1976016438):0.2934554554):1.386367897);
(((t106:0.4193653252,((t107:0.3682397668)#H5:0.05112555842::0.5315914391)#H6:0.0::0.5386853367):1.937479268,((t102:1.149985331,((t104:0.6915281061,(t108:0.3427674648,((((t122:0.01640336039,t123:0.01640336039):0.222391879,(t114:0.1541330074,t115:0.1541330074):0.08466223198):0.1465271767)#H7:0.0::0.5189692522,t109:0.3427674648):0.04255495136):0.3062056899):0.2782191261,((t118:0.06730917365,t119:0.06730917365):0.3847626491,(#H7:0.03404290905::0.4810307478,#H6:0.0::0.4613146633):0.03270649749):0.5176754095):0.1802380989):0.3868155239,((((t124:0.01503080612,t125:0.01503080612):0.1087524059,(t117:0.123783212)#H8:0.0::0.562150952):0.3405604516,((t110:0.3287278247,#H5:0.0::0.4684085609):0.03951194206,(t120:0.043456529,t121:0.043456529):0.2852712957):0.09610389679):0.107853075,((t116:0.123783212,#H8:0.0::0.437849048):1.375338908,t105:0.5721967386):0.926925381):0.03767873538):0.8200437383):0.8526995075,(t103:0.9588221669,(t101:3.050216116,((t112:0.2278944252,t113:0.2278944252):0.05133902422,t111:0.2792334494):0.6795887175):2.091393949):0.1593279847);
((((t174:0.04264101133,t175:0.04264101133):0.721809645,t155:0.7644506564):0.4346212023,(((t160:0.5479309106,t161:0.5479309106):0.003716548424,t159:0.551647459):0.3610906444,(t170:0.1733492091,t171:0.1733492091):0.7393888943):0.2863337553):1.214073885,((((t158:0.5715820203)#H9:1.036060523::0.7536989497,(t152:1.099145024,t153:1.099145024):0.5084975191):0.4037633607,t151:2.011405904):0.2960527334,(((t154:0.8552473344,(t163:0.4547280499,(t164:0.430595113,t165:0.430595113):0.02413293684):0.1179718416):0.282547443,(((t166:0.3646647508)#H10:0.1008666219::0.5073266014,t162:0.4655313727):0.1071685188,(t172:0.04812246219,t173:0.04812246219):0.9511526783):0.144027806):0.8700810038,(t156:0.7113583062,((t167:0.3646647508,#H10:0.0::0.4926733986):0.3466935554,(t157:0.6338908293,((t168:0.1887297148,t169:0.1887297148):0.3828523056,#H9:0.0::0.2463010503):0.06230880896):0.7083561799):0.630888703):0.5271091351):0.4381024929):0.1056871068);
(((t183:0.716381468,(t179:0.9454660101,((t199:0.02610431374,t200:0.02610431374):0.2404086846,(t191:0.1890544433,t192:0.1890544433):0.07745855503):0.4498684697):0.2290845422):0.8164696154,((t193:0.1688572472,t194:0.1688572472):0.8167015507,((t180:0.7852769849,t181:0.7852769849):0.02549898804,(t182:0.7543912639,(((t188:0.2996989776,t189:0.2996989776):0.2074311971,t185:0.5071301747):0.02342347594,t184:0.5305536506):0.2238376133):0.05638470901):0.1747828249):0.7763768276):1.733472401,(((t177:1.676776617,(t178:1.266278556,(t197:0.03970487013,t198:0.03970487013):1.226573686):0.4104980603):0.1914425678,((t196:0.08116598626,(t195:0.08116598626,t190:0.2189268203):0.137760834):0.8858230835,(t186:0.3017755493,t187:0.3017755493):0.8029743545):0.7634692807):0.07398329336,t176:1.942202478):1.553205548);
(((t12:0.2957477985,t13:0.2957477985):0.005972791157,((((t22:0.0253096392,(t16:0.1081081426,(t14:0.282164117,t15:0.282164117):0.06623446392):0.2402904384):0.08202464829,(t21:0.02608349427,t23:0.0253096392):0.0007738550691):0.02552990962,t8:0.3739284906):0.1546455328,t11:0.3017205897):0.2268534337):0.6833141831,(t6:0.4929453643,t7:0.4929453643):0.7189428421);
(OUTGROUP:1.0,((t2:1.45026966,((((t3:1.077611248,t5:0.8759651303):0.2016461181,t4:0.8759651303):0.1381220391,((t17:0.04562304902,t18:0.04562304902):0.4539615327,((t24:0.009000491096,t25:0.009000491096):0.6718449685,(t9:0.3696263484,t10:0.3696263484):0.1299582333):0.1812608779):0.5348878278):0.2345363726,t1:1.474136404):0.02386674411):1.692472462,(t19:0.03593273446,t20:0.03593273446):3.130676131));
(((((t145:0.161929347,t146:0.161929347):0.04268839961,t142:0.2046177466):0.2377548328,t140:0.4423725794):1.348478184,(((((t138:0.5418834959,t139:0.5418834959):0.5745978546,t130:0.9035913546):0.2128899959,(t149:0.05358872787,t150:0.05358872787):0.8500026267):0.1115036667,(t132:0.7640825867,t133:0.7640825867):0.5407652352):0.0768628048,(t128:1.227985017,t126:1.774575325):0.4697275026):0.01627543905):0.2366856452,(((((t134:0.573730955,t135:0.573730955):0.3608410715,((t141:0.2497781618,(t143:0.2001454606,t144:0.2001454606):0.04963270121):0.5080657775,(t147:0.09569501053,t148:0.09569501053):0.6621489287):0.1767280872):0.1832260983,t129:1.117798125):0.2151053121,t127:1.332903437):0.0627117816,(t131:0.7888747526,(t136:0.5645521056,t137:0.5645521056):0.224322647):0.6067404658):0.6319211904);
((((t43:0.1794608497,((((t41:0.4384227323,#H1:0.0::0.4431175922):0.4602702731,t33:0.8986930054):0.08675752039,t30:0.9854505258):0.1354329038,t44:0.1794608497):0.9414225799):0.3118744353,((((((t47:0.08767142474,t48:0.08767142474):0.2857224575,t42:0.3733938822):0.0650288501)#H1:0.2600005089::0.5568824078,(t28:1.525724441,t35:0.6984232412):0.8273012002):0.2261420064,(((t49:0.002532485575,(t32:0.9034885216,t50:0.002532485575):0.9009560361):0.05872361433)#H2:0.0::0.645809419,t31:0.962212136):0.7896543118):0.3880744254,(t27:1.568487869,((t39:0.4898565291,t40:0.4898565291):0.1867338717,t36:0.6765904009):0.8918974679):0.5714530044):0.1076271098):0.8148101181,(t37:0.6473520662,t38:0.6473520662):0.7854057987):7.204310168e-5,((t29:1.022517073,#H2:0.06030493691::0.354190581):0.8204947917,(t26:1.64051951,((t45:0.1657339959,t46:0.1657339959):0.58585488,t34:0.7515888758):0.888930634):0.2024923548):0.4046281615);", "\n")]

truenet = readTopology("((((((((t174:0.04264101133,t175:0.04264101133):0.721809645,t155:0.7644506564):0.4346212023,(((t160:0.5479309106,t161:0.5479309106):0.003716548424,t159:0.551647459):0.3610906444,(t170:0.1733492091,t171:0.1733492091):0.7393888943):0.2863337553):1.214073885,((((t158:0.5715820203)#H9:1.036060523::0.7536989497,(t152:1.099145024,t153:1.099145024):0.5084975191):0.4037633607,t151:2.011405904):0.2960527334,(((t172:0.04812246219,t173:0.04812246219):0.9511526783,(t154:0.8552473344,(((t166:0.3646647508)#H10:0.1008666219::0.5073266014,t162:0.4655313727):0.1071685188,(t163:0.4547280499,(t164:0.430595113,t165:0.430595113):0.02413293684):0.1179718416):0.282547443):0.144027806):0.8700810038,((t157:0.6338908293,((t168:0.1887297148,t169:0.1887297148):0.3828523056,#H9:0.0::0.2463010503):0.06230880896):0.7083561799,((t167:0.3646647508,#H10:0.0::0.4926733986):0.3466935554,t156:0.7113583062):0.630888703):0.5271091351):0.4381024929):0.1056871068):0.1119152771,(((t179:0.9454660101,(t183:0.716381468,((t199:0.02610431374,t200:0.02610431374):0.2404086846,(t191:0.1890544433,t192:0.1890544433):0.07745855503):0.4498684697):0.2290845422):0.8164696154,((t193:0.1688572472,t194:0.1688572472):0.8167015507,((t180:0.7852769849,t181:0.7852769849):0.02549898804,(t182:0.7543912639,(((t188:0.2996989776,t189:0.2996989776):0.2074311971,t185:0.5071301747):0.02342347594,t184:0.5305536506):0.2238376133):0.05638470901):0.1747828249):0.7763768276):1.733472401,(((t177:1.676776617,(t178:1.266278556,(t197:0.03970487013,t198:0.03970487013):1.226573686):0.4104980603):0.1914425678,((t190:0.2189268203,(t195:0.08116598626,t196:0.08116598626):0.137760834):0.8858230835,(t186:0.3017755493,t187:0.3017755493):0.8029743545):0.7634692807):0.07398329336,t176:1.942202478):1.553205548):0.1119152771):1.708371278,(((((t11:0.3017205897,(t12:0.2957477985,t13:0.2957477985):0.005972791157):0.2268534337,(((t14:0.282164117,t15:0.282164117):0.06623446392,(t16:0.1081081426,((t22:0.0253096392,t23:0.0253096392):0.0007738550691,t21:0.02608349427):0.08202464829):0.2402904384):0.02552990962,t8:0.3739284906):0.1546455328):0.6833141831,(t6:0.4929453643,t7:0.4929453643):0.7189428421):0.1682966241,(t19:0.03593273446,t20:0.03593273446):1.344252096):1.786424035,(t1:1.474136404,((((t4:0.8759651303,t5:0.8759651303):0.2016461181,t3:1.077611248):0.1381220391,(((t9:0.3696263484,t10:0.3696263484):0.1299582333,(t17:0.04562304902,t18:0.04562304902):0.4539615327):0.1812608779,(t24:0.009000491096,t25:0.009000491096):0.6718449685):0.5348878278):0.2345363726,t2:1.45026966):0.02386674411):1.692472462):1.820286555):0.4088648072,((((((t56:0.4198231732,((t72:0.08480279492,t73:0.08480279492):0.3350203783)#H4:0.0::0.5927107882):1.141125203,(t55:0.4221967992,(t64:0.2473939322,t65:0.2473939322):0.174802867):1.138751577):0.165097794,((((t54:0.4642544649,(t68:0.1757050026,t69:0.1757050026):0.2885494623):0.7057635076,t51:1.170017972):0.07910449534,((t60:0.3281279794,t61:0.3281279794):0.09169519386,#H4:0.0::0.4072892118):0.8292992946):0.3910061092,(t59:0.3683683659,(t74:0.02494319292,t75:0.02494319292):0.343425173):1.271760211):0.08591759313):1.444116608,((t52:0.9107015005,(t70:0.1302613159,t71:0.1302613159):0.7804401846):0.7772913367,((t62:0.2542254334,t63:0.2542254334):1.431866722,((t57:0.3790001775,t58:0.3790001775):1.139600672,(t53:0.535665894,(t66:0.2380711355,t67:0.2380711355):0.2975947585):0.9829349551):0.1674913061):0.001900682083):1.482169941):0.131159138,((((((t92:0.1231955358,t93:0.1231955358):0.4537598567,(t83:0.2714159532,t84:0.2714159532):0.3055394393):0.5435278315,(t78:0.6872718197,t79:0.6872718197):0.4332114043):0.1336780598,t77:1.254161284):0.1232131407,(t76:1.292931397,(((t90:0.1690663621,t91:0.1690663621):0.1709390601,((t81:0.3125054383,t82:0.3125054383):0.00143089632,((t99:0.02800027315,t100:0.02800027315):0.08606093649,t94:0.1140612096):0.199875125):0.02606908751):0.1904480454,((t85:0.2489316268,t86:0.2489316268):0.09251823225,t80:0.3414498591):0.1890036085):0.7624779295):0.08444302737):0.5000505714,(((t88:0.1789034623,t89:0.1789034623):0.2956974678,(t97:0.05046667997,t98:0.05046667997):0.4241342502):0.01645616901,((t95:0.1089569553,t96:0.1089569553):0.08864468848,t87:0.1976016438):0.2934554554):1.386367897):0.131159138):1.62941429,(((((t106:0.4193653252,((t107:0.3682397668)#H5:0.05112555842::0.5315914391)#H6:0.0::0.5386853367):1.937479268,((t102:1.149985331,((t104:0.6915281061,#H7:0.3062056899::0.4810307478):0.2782191261,((t118:0.06730917365,t119:0.06730917365):0.3847626491,(((((t122:0.01640336039,t123:0.01640336039):0.222391879,(t114:0.1541330074,t115:0.1541330074):0.08466223198):0.1465271767)#H7:0.0::0.5189692522,(t108:0.3427674648,t109:0.3427674648):0.04255495136):0.03404290905,#H6:0.0::0.4613146633):0.03270649749):0.5176754095):0.1802380989):0.3868155239,((t105:0.5721967386,(((t124:0.01503080612,t125:0.01503080612):0.1087524059,(t117:0.123783212)#H8:0.0::0.562150952):0.3405604516,((t110:0.3287278247,(t120:0.043456529,t121:0.043456529):0.2852712957):0.03951194206,#H5:0.0::0.4684085609):0.09610389679):0.107853075):0.926925381,(t116:0.123783212,#H8:0.0::0.437849048):1.375338908):0.03767873538):0.8200437383):0.8526995075,((((t112:0.2278944252,t113:0.2278944252):0.05133902422,t111:0.2792334494):0.6795887175,t103:0.9588221669):2.091393949,t101:3.050216116):0.1593279847):0.1176863709,(((((t145:0.161929347,t146:0.161929347):0.04268839961,t142:0.2046177466):0.2377548328,t140:0.4423725794):1.348478184,(t126:1.774575325,((t132:0.7640825867,t133:0.7640825867):0.5407652352,((((t149:0.05358872787,t150:0.05358872787):0.8500026267,t130:0.9035913546):0.2128899959,(t138:0.5418834959,t139:0.5418834959):0.5745978546):0.1115036667,t128:1.227985017):0.0768628048):0.4697275026):0.01627543905):0.2366856452,(((((t134:0.573730955,t135:0.573730955):0.3608410715,((t141:0.2497781618,(t143:0.2001454606,t144:0.2001454606):0.04963270121):0.5080657775,(t147:0.09569501053,t148:0.09569501053):0.6621489287):0.1767280872):0.1832260983,t129:1.117798125):0.2151053121,t127:1.332903437):0.0627117816,(t131:0.7888747526,(t136:0.5645521056,t137:0.5645521056):0.224322647):0.6067404658):0.6319211904):0.1176863709):1.086626635,((((((t43:0.1794608497,t44:0.1794608497):0.9414225799,(((t41:0.4384227323,#H1:0.0::0.4431175922):0.4602702731,t33:0.8986930054):0.08675752039,t30:0.9854505258):0.1354329038):0.3118744353,(t37:0.6473520662,t38:0.6473520662):0.7854057987):0.8148101181,(((t28:1.525724441,(t35:0.6984232412,(((t47:0.08767142474,t48:0.08767142474):0.2857224575,t42:0.3733938822):0.0650288501)#H1:0.2600005089::0.5568824078):0.8273012002):0.2261420064,((((t49:0.002532485575,t50:0.002532485575):0.9009560361,t32:0.9034885216):0.05872361433)#H2:0.0::0.645809419,t31:0.962212136):0.7896543118):0.3880744254,(t27:1.568487869,((t39:0.4898565291,t40:0.4898565291):0.1867338717,t36:0.6765904009):0.8918974679):0.5714530044):0.1076271098):7.204310168e-5,#H3:0.0::0.4283784431):0.09713195803,(((t29:1.022517073,#H2:0.06030493691::0.354190581):0.8204947917,(t26:1.64051951,((t45:0.1657339959,t46:0.1657339959):0.58585488,t34:0.7515888758):0.888930634):0.2024923548):0.4046281615)#H3:0.09713195803::0.5716215569):1.204313006):0.5562604223):0.4685779348),OUTGROUP:1.0);")

_, namelist = majorinternodecount(truenet)
D = Matrix(CSV.read("/mnt/dv/wid/projects4/SolisLemus-network-merging/dmat1.csv", DataFrame))
mnet = netnj(D, constraints, namelist)

using PhyloPlots
PhyloPlots.plot(constraints[1])





cc = readTopology("((A,(B,#H1)),(C)#H1);")
_, namelist = majorinternodecount(cc)
D = Matrix{Float64}([0. 2. 3.; 2. 0. 0.; 3. 0. 0.])
mnet = netnj(D, [cc], namelist)