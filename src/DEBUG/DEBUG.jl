using Revise
include("../../simulations/pipelines.jl")
include("../../simulations/robustness-fxns.jl")


constring = "(((t7:0.1274160069,t12:0.1274160069):0.6635707933,((t89:0.03088616148,#H210:0.0::0.4119033075):0.7897027267,(((t45:0.2282862573,t57:0.01264344853):0.2156428088,t8:0.01264344853):0.1673365833,(t79:0.03088616148,(t95:0.3445050002,(t74:0.03088616148)#H210:0.0::0.5880966925):0.3136188387):0.0511178404):0.3953639596):0.02960208799):0.1392732877,t11:0.9598621758);
((((t73:0.1618073494,t2:0.1618073494):0.1641355628,(t99:0.5720132329,t4:0.3259429123):0.2460703207):1.261653249,(t86:0.1886691074,t66:0.1886691074):1.644997374):0.2379123601,((t1:0.03979549232,t52:0.03979549232):1.113284563,(t61:0.1343376738,((t85:0.7276450705,(t50:0.1267715579,t58:0.1267715579):0.6008735126):0.2005529555,t40:0.1343376738):0.7938603523):0.2248820295):0.9184987861070001);
((t10:0.3502570469,t64:0.3502570469):0.7523154583,(((t3:0.6151940018,t65:0.6151940018):0.009455564983,((t33:0.5361501396,t21:0.5361501396):0.06455944562,t60:0.6007095852):0.02393998158):0.229265774,(t36:0.8539153408,t69:1.092344923):0.2384295821):0.01022758223);    
(((((t48:0.01367642199,t98:0.01367642199):0.4413712687,t54:0.4550476907):0.5974205656,(t49:0.9977010919)#H171:0.05476716445::0.620164132):1.276721856,#H171:1.3314890204999998::0.379835868):0.5012883267,((t83:0.6520089623,((t29:1.255986139,t6:1.255986139):0.3984025883,t56:0.6520089623):1.002379765):0.03844603899,t47:1.6928347664999999):1.137643673);
(((((t41:0.09465705565,t82:0.09465705565):0.1524039436,(t17:0.01944473903,t31:0.01944473903):0.2276162602):0.8839506752,((t25:0.0414598684,t19:0.0414598684):1.497911846)#H142:0.0::0.5236008975):0.40836004,((t72:0.3519395895,t88:0.3519395895):0.0115303679,(t55:0.3104054258,t32:0.3104054258):0.05306453161):0.767541717):1.7563646092,#H142:1.7563646088::0.4763991025);
((t67:1.981731786,((t46:0.2655933799,t42:0.2655933799):1.681906924,((t76:1.400126024,t38:1.137533782):0.2625922419,t93:1.137533782):0.5473742804):0.0342314822):0.2317983601,(((t80:0.06042664553,t94:0.06042664553):0.4607524907,(t34:0.5211791362,t23:0.8007654323):0.2795862961):0.1256763014,(t90:0.6755803293,(t71:0.4417187054,(t35:0.3009345523,t97:0.3009345523):0.1407841531):0.2338616239):0.2508614045):1.2870884129);
(((t100:0.5194471847,t30:0.5194471847):1.247433742,(t5:0.3445897906,t37:0.3445897906):1.422291136):0.1077035015,((t15:0.1672542475,(t62:0.1672542475)#H154:0.0::0.591028565):1.23462832,(((t16:0.6825008686,t81:0.6825008686):0.483243364,#H154:0.9984899852::0.408971435):0.07591357137,t53:1.241657804):0.1602247633):0.4727018606);
(((t84:1.274301072,(t28:0.01998087007,t51:0.01998087007):0.08915822509):1.165161977,t70:0.1091390952):0.8267467304,(t77:0.6608330851,(t92:2.0463330519,t96:0.6608330851):1.385499967216):0.05471475099);
((t22:0.4052219802,(t59:1.037887418,t27:0.4052219802):0.6326654375):0.1118023523,((t39:0.07687049131,((t24:0.4652105473,t91:0.4652105473):0.0827838273,t14:0.07687049131):0.4711238833):0.3444825836,(t63:0.6166761712,(t9:0.5045571747,t75:0.5045571747):0.1121189965):0.275800787):0.2572128119);
(((((((t13:1.09805948,((t43:0.2271025705,t44:0.2271025705):0.5707815835,(t78:1.053981172,t18:0.797884154):0.2560970181):0.04407830749):0.06330128539)#H146:0.3124631859::0.6877065032,(t87:0.2822990029,t20:0.2822990029):1.191524948):0.8941402378,#H146:1.2066034236899998::0.3122934968):0.9932694209999999,t68:0.4858761162):2.87535749325,t26:0.4858761162),OUTGROUP:1.0);"
constraints = [readTopology(c) for c in split(constring, "\n")]
truenet = readTopology("(((((((((t41:0.09465705565,t82:0.09465705565):0.1524039436,(t17:0.01944473903,t31:0.01944473903):0.2276162602):0.8839506752,((t72:0.3519395895,t88:0.3519395895):0.0115303679,(t55:0.3104054258,t32:0.3104054258):0.05306453161):0.767541717):0.40836004,((t25:0.0414598684,t19:0.0414598684):1.497911846)#H142:0.0::0.5236008975):0.2033456481,((t23:0.8007654323,(t34:0.5211791362,(t80:0.06042664553,t94:0.06042664553):0.4607524907):0.2795862961):0.1256763014,(t90:0.6755803293,(t71:0.4417187054,(t35:0.3009345523,t97:0.3009345523):0.1407841531):0.2338616239):0.2508614045):0.8162756288):0.4708127841,(t67:1.981731786,((t46:0.2655933799,t42:0.2655933799):1.681906924,((t93:1.137533782,t38:1.137533782):0.2625922419,t76:1.400126024):0.5473742804):0.0342314822):0.2317983601):1.082206177,((t26:0.4858761162,t68:0.4858761162):2.640462657,((((t22:0.4052219802,t27:0.4052219802):0.6326654375,t59:1.037887418):0.1118023523,(((t24:0.4652105473,t91:0.4652105473):0.0827838273,(t39:0.07687049131,t14:0.07687049131):0.4711238833):0.3444825836,(t63:0.6166761712,(t9:0.5045571747,t75:0.5045571747):0.1121189965):0.275800787):0.2572128119):0.3896819443,#H142:0.0::0.4763991025):1.586967059):0.1693975498):0.06549728645,(((((t13:1.09805948,(((t43:0.2271025705,t44:0.2271025705):0.5707815835,t18:0.797884154):0.2560970181,t78:1.053981172):0.04407830749):0.06330128539)#H146:0.3124631859::0.6877065032,(t87:0.2822990029,t20:0.2822990029):1.191524948):0.8941402378,((((t51:0.01998087007,t28:0.01998087007):0.08915822509,t70:0.1091390952):1.165161977,t84:1.274301072):0.8267467304,((t92:1.161360765,#H146:0.0::0.3122934968):0.8849722869,((t77:0.6608330851,t96:0.6608330851):1.376066162,(((t100:0.5194471847,t30:0.5194471847):1.247433742,(t5:0.3445897906,t37:0.3445897906):1.422291136):0.1077035015,((t15:0.1672542475,(t62:0.1672542475)#H154:0.0::0.591028565):1.23462832,(((t16:0.6825008686,t81:0.6825008686):0.483243364,#H154:0.9984899852::0.408971435):0.07591357137,t53:1.241657804):0.1602247633):0.4727018606):0.1623148187):0.009433805216):0.05471475099):0.2669163858):0.6033442209,(((((t48:0.01367642199,t98:0.01367642199):0.4413712687,t54:0.4550476907):0.5974205656,(t49:0.9977010919)#H171:0.05476716445::0.620164132):1.276721856,(((((t73:0.1618073494,t2:0.1618073494):0.1641355628,t4:0.3259429123):0.2460703207,t99:0.5720132329):1.261653249,(t86:0.1886691074,t66:0.1886691074):1.644997374):0.2379123601,(((t1:0.03979549232,t52:0.03979549232):1.113284563,((t85:0.7276450705,(t50:0.1267715579,t58:0.1267715579):0.6008735126):0.2005529555,(t40:0.1343376738,t61:0.1343376738):0.7938603523):0.2248820295):0.002454157107,(((((t7:0.1274160069,t12:0.1274160069):0.6635707933,(((t8:0.01264344853,t57:0.01264344853):0.2156428088,t45:0.2282862573):0.1673365833,((t79:0.03088616148,(t74:0.03088616148)#H210:0.0::0.5880966925):0.3136188387,t95:0.3445050002):0.0511178404):0.3953639596):0.02960208799,(t89:0.03088616148,#H210:0.0::0.4119033075):0.7897027267):0.1392732877,t11:0.9598621758):0.03783891605,#H171:0.0::0.379835868):0.1578331208):0.916044629):0.2576112707):0.5012883267,(((t56:0.6520089623,t83:0.6520089623):1.002379765,(t29:1.255986139,t6:1.255986139):0.3984025883):0.03844603899,(((t10:0.3502570469,t64:0.3502570469):0.7523154583,(t69:1.092344923,(((t3:0.6151940018,t65:0.6151940018):0.009455564983,((t33:0.5361501396,t21:0.5361501396):0.06455944562,t60:0.6007095852):0.02393998158):0.229265774,t36:0.8539153408):0.2384295821):0.01022758223):0.04714230789,t47:1.149714813):0.5431199535):1.137643673):0.1408299704):0.3899252001),OUTGROUP:1.0);")
D, namelist = majorinternodedistance(truenet)

mnet = netnj(D, constraints, namelist)





# Key error??

constring = "((((t7:0.1274160069,t12:0.1274160069):0.6635707933,(((t8:0.01264344853,t57:0.01264344853):0.2156428088,t45:0.2282862573):0.1673365833,((t79:0.03088616148,(t74:0.03088616148)#H210:0.0::0.5880966925):0.3136188387,t95:0.3445050002):0.0511178404):0.3953639596):0.02960208799,(t89:0.03088616148,#H210:0.0::0.4119033075):0.7897027267):0.1392732877,t11:0.9598621758);
(((((t73:0.1618073494,t2:0.1618073494):0.1641355628,t4:0.3259429123):0.2460703207,t99:0.5720132329):1.261653249,(t86:0.1886691074,t66:0.1886691074):1.644997374):0.2379123601,((t1:0.03979549232,t52:0.03979549232):1.113284563,((t85:0.7276450705,(t50:0.1267715579,t58:0.1267715579):0.6008735126):0.2005529555,(t40:0.1343376738,t61:0.1343376738):0.7938603523):0.2248820295):0.9184987861070001);
((t10:0.3502570469,t64:0.3502570469):0.7523154583,(t69:1.092344923,(((t3:0.6151940018,t65:0.6151940018):0.009455564983,((t33:0.5361501396,t21:0.5361501396):0.06455944562,t60:0.6007095852):0.02393998158):0.229265774,t36:0.8539153408):0.2384295821):0.01022758223);
(((((t48:0.01367642199,t98:0.01367642199):0.4413712687,t54:0.4550476907):0.5974205656,(t49:0.9977010919)#H171:0.05476716445::0.620164132):1.276721856,#H171:1.3314890204999998::0.379835868):0.5012883267,(((t56:0.6520089623,t83:0.6520089623):1.002379765,(t29:1.255986139,t6:1.255986139):0.3984025883):0.03844603899,t47:1.6928347664999999):1.137643673);
(((((t41:0.09465705565,t82:0.09465705565):0.1524039436,(t17:0.01944473903,t31:0.01944473903):0.2276162602):0.8839506752,(t55:0.3104054258,((t72:0.3519395895,t88:0.3519395895):0.0115303679,t32:0.3104054258):0.05306453161):0.767541717):0.40836004,(t19:0.0414598684,#H142:0.0414598684::0.4763991025):0.0):1.7563646092,(t25:0.0)#H142:1.7563646088::0.5236008975);
((t67:1.981731786,((t46:0.2655933799,t42:0.2655933799):1.681906924,((t93:1.137533782,t38:1.137533782):0.2625922419,t76:1.400126024):0.5473742804):0.0342314822):0.2317983601,((t23:0.8007654323,(t90:0.6755803293,(t71:0.4417187054,(t35:0.3009345523,t97:0.3009345523):0.1407841531):0.2338616239):0.2508614045):0.1256763014,(t34:0.5211791362,(t80:0.06042664553,t94:0.06042664553):0.4607524907):0.2795862961):1.2870884129);
((((t5:0.3445897906,t37:0.3445897906):1.422291136,t30:0.5194471847):1.247433742,t100:0.5194471847):0.1077035015,((t15:0.1672542475,(t62:0.1672542475)#H154:0.0::0.591028565):1.23462832,(((t16:0.6825008686,t81:0.6825008686):0.483243364,#H154:0.9984899852::0.408971435):0.07591357137,t53:1.241657804):0.1602247633):0.4727018606);
(((t51:0.01998087007,t28:0.01998087007):0.08915822509,(t84:1.274301072,t70:0.1091390952):1.165161977):0.8267467304,(t92:2.0463330519,(t77:0.6608330851,t96:0.6608330851):1.385499967216):0.05471475099);
(((t22:0.4052219802,t27:0.4052219802):0.6326654375,t59:1.037887418):0.1118023523,((t9:0.5045571747,t75:0.5045571747):0.1121189965,((t39:0.07687049131,t14:0.07687049131):0.4711238833,(t63:0.6166761712,(t24:0.4652105473,t91:0.4652105473):0.0827838273):0.3444825836):0.275800787):0.2572128119);
(((t26:0.4858761162,t68:0.4858761162):2.87535749325,((((t13:1.09805948,((t43:0.2271025705,t44:0.2271025705):0.5707815835,(t78:1.053981172,t18:0.797884154):0.2560970181):0.04407830749):0.06330128539)#H146:0.3124631859::0.6877065032,(t87:0.2822990029,t20:0.2822990029):1.191524948):0.8941402378,#H146:1.2066034236899998::0.3122934968):0.9932694209999999),OUTGROUP:1.0);"
constraints = [readTopology(c) for c in split(constring, "\n")]
truenet = readTopology("(((((((((t41:0.09465705565,t82:0.09465705565):0.1524039436,(t17:0.01944473903,t31:0.01944473903):0.2276162602):0.8839506752,((t72:0.3519395895,t88:0.3519395895):0.0115303679,(t55:0.3104054258,t32:0.3104054258):0.05306453161):0.767541717):0.40836004,((t25:0.0414598684,t19:0.0414598684):1.497911846)#H142:0.0::0.5236008975):0.2033456481,((t23:0.8007654323,(t34:0.5211791362,(t80:0.06042664553,t94:0.06042664553):0.4607524907):0.2795862961):0.1256763014,(t90:0.6755803293,(t71:0.4417187054,(t35:0.3009345523,t97:0.3009345523):0.1407841531):0.2338616239):0.2508614045):0.8162756288):0.4708127841,(t67:1.981731786,((t46:0.2655933799,t42:0.2655933799):1.681906924,((t93:1.137533782,t38:1.137533782):0.2625922419,t76:1.400126024):0.5473742804):0.0342314822):0.2317983601):1.082206177,((t26:0.4858761162,t68:0.4858761162):2.640462657,((((t22:0.4052219802,t27:0.4052219802):0.6326654375,t59:1.037887418):0.1118023523,(((t24:0.4652105473,t91:0.4652105473):0.0827838273,(t39:0.07687049131,t14:0.07687049131):0.4711238833):0.3444825836,(t63:0.6166761712,(t9:0.5045571747,t75:0.5045571747):0.1121189965):0.275800787):0.2572128119):0.3896819443,#H142:0.0::0.4763991025):1.586967059):0.1693975498):0.06549728645,(((((t13:1.09805948,(((t43:0.2271025705,t44:0.2271025705):0.5707815835,t18:0.797884154):0.2560970181,t78:1.053981172):0.04407830749):0.06330128539)#H146:0.3124631859::0.6877065032,(t87:0.2822990029,t20:0.2822990029):1.191524948):0.8941402378,((((t51:0.01998087007,t28:0.01998087007):0.08915822509,t70:0.1091390952):1.165161977,t84:1.274301072):0.8267467304,((t92:1.161360765,#H146:0.0::0.3122934968):0.8849722869,((t77:0.6608330851,t96:0.6608330851):1.376066162,(((t100:0.5194471847,t30:0.5194471847):1.247433742,(t5:0.3445897906,t37:0.3445897906):1.422291136):0.1077035015,((t15:0.1672542475,(t62:0.1672542475)#H154:0.0::0.591028565):1.23462832,(((t16:0.6825008686,t81:0.6825008686):0.483243364,#H154:0.9984899852::0.408971435):0.07591357137,t53:1.241657804):0.1602247633):0.4727018606):0.1623148187):0.009433805216):0.05471475099):0.2669163858):0.6033442209,(((((t48:0.01367642199,t98:0.01367642199):0.4413712687,t54:0.4550476907):0.5974205656,(t49:0.9977010919)#H171:0.05476716445::0.620164132):1.276721856,(((((t73:0.1618073494,t2:0.1618073494):0.1641355628,t4:0.3259429123):0.2460703207,t99:0.5720132329):1.261653249,(t86:0.1886691074,t66:0.1886691074):1.644997374):0.2379123601,(((t1:0.03979549232,t52:0.03979549232):1.113284563,((t85:0.7276450705,(t50:0.1267715579,t58:0.1267715579):0.6008735126):0.2005529555,(t40:0.1343376738,t61:0.1343376738):0.7938603523):0.2248820295):0.002454157107,(((((t7:0.1274160069,t12:0.1274160069):0.6635707933,(((t8:0.01264344853,t57:0.01264344853):0.2156428088,t45:0.2282862573):0.1673365833,((t79:0.03088616148,(t74:0.03088616148)#H210:0.0::0.5880966925):0.3136188387,t95:0.3445050002):0.0511178404):0.3953639596):0.02960208799,(t89:0.03088616148,#H210:0.0::0.4119033075):0.7897027267):0.1392732877,t11:0.9598621758):0.03783891605,#H171:0.0::0.379835868):0.1578331208):0.916044629):0.2576112707):0.5012883267,(((t56:0.6520089623,t83:0.6520089623):1.002379765,(t29:1.255986139,t6:1.255986139):0.3984025883):0.03844603899,(((t10:0.3502570469,t64:0.3502570469):0.7523154583,(t69:1.092344923,(((t3:0.6151940018,t65:0.6151940018):0.009455564983,((t33:0.5361501396,t21:0.5361501396):0.06455944562,t60:0.6007095852):0.02393998158):0.229265774,t36:0.8539153408):0.2384295821):0.01022758223):0.04714230789,t47:1.149714813):0.5431199535):1.137643673):0.1408299704):0.3899252001),OUTGROUP:1.0);")
D, namelist = majorinternodedistance(truenet)

mnet = netnj(D, constraints, namelist)