using Revise
include("../../simulations/pipelines.jl")
include("../../simulations/robustness-fxns.jl")

cs = [readTopology(c) for c in split("((((t68:0.2065356603,((((t53:0.1113005355,t50:0.1113005355):0.04432958978,t40:0.117977806):0.03765231934,t31:0.117977806):0.1530258405,t73:0.2065356603):0.1021203055):0.01089651029,t96:0.3195524761):0.2098794484,t34:0.5294319244):0.9579286632,t90:1.487360588);
((t52:0.261105943,t85:0.261105943):2.417407441,(((t55:0.04061377758,(t2:0.4670806173,(t41:0.2156929686,t66:0.2156929686):0.2513876487):0.3158168406):0.7422836803,t39:0.04061377758):0.3886863712,(t13:0.002361487328,t18:0.002361487328):1.169222342):1.5069295544);
((((t45:0.713593169,t6:0.713593169):0.3909433556,((t77:0.6075883596,t21:0.6075883596):0.4199592114,t36:1.027547571):0.07698895362):0.8810617716,(t37:1.119341441,t23:1.119341441):0.8662568555):0.3976699498,((t64:2.153301804,(t42:0.03840320956,t70:0.03840320956):0.6241795456):1.490719049,(t3:0.6564742276,(t78:0.02151701115,t30:0.02151701115):0.6349572164):0.006108527606):0.2299664418);
((((t86:0.4393284171,t8:0.4393284171):0.2076416515,(t35:0.8283249555,(t62:0.6469700686)#H172:0.1813548869::0.7191475851):0.0):0.744223159,#H128:0.5628682721::0.396696121):0.2952212144,((t87:0.2571742635,t72:0.2571742635):0.04463586193,(((t32:0.4739880036,t46:0.4739880036):0.8131487364,((#H172:0.0::0.2808524149)#H128:0.8509902879::0.603303879,t48:0.7469338003):0.0):0.2488266283,(t76:0.1297385709,t69:0.1297385709):0.1720715546):1.234153243):0.897384874);
((t10:1.154173507,((t83:1.5106571,t47:1.727791047):0.2171339475,t44:1.154173507):0.3564835929):0.8060675791,((t7:0.4012149549,((t17:0.0266758688,(t57:0.2577377349,t28:0.0266758688):0.2310618661):0.004916829693,t15:0.2626545646):0.1385603903):0.6955730723,(t67:0.9401537809,(t63:0.3894980428,(t71:0.6368969617,t92:0.3894980428):0.2473989189):0.3032568192):0.15663424633):1.4370705995100002);
((((t93:0.1192188787,t88:0.1192188787):0.7135662172,(t61:0.4985575713,(t95:0.03097553347,t43:0.03097553347):0.4675820379):0.3342275246):0.4701991894,((t38:0.2310500186,t74:0.1329376313):0.09811238733,(((t25:0.3275492391,t82:0.3275492391):0.3285882181,t1:0.6561374572):0.424281809,t11:0.1329376313):0.8493692476):0.2225650191):0.9275490644,(t97:0.8252488869,t5:0.8252488869):1.405284463);
(((t4:0.4935476682,t80:0.4935476682):0.2757884723)#H139:0.8685467319::0.5051413627,((t99:0.0491435253,t14:1.023568054):0.9744245288,(((t75:0.02703292514,t84:0.5596095031):0.2097266374,(#H139:0.0::0.4948586373,t54:0.02703292514):0.532576578):0.5989232143,t51:0.0491435253):0.3446913007):0.2696235176);
((t100:0.352200557,((((t27:0.1911785185,t29:0.1911785185):0.1619086624,t89:0.353087181):0.09955462346,(t91:0.8422227425,t81:0.45264180443):0.389580938):0.07854236488,t24:0.352200557):0.5685645504):0.5612649503,(t26:0.2787387563,t16:0.2787387563):1.203291301);
(((((t58:0.03071116952,(t12:0.03071116952,t56:0.04624646874):0.01553529922):0.03055235709,t49:0.2724649979):0.1956661721,(t20:0.8069029778,t98:0.07679882582):1.681198845):1.146760865,(t9:0.6320905062,(t33:0.4130133271,((t60:0.2686887862,t59:0.2686887862):0.0)#H164:0.1443245409::0.5845266774):0.0):0.1748124716):1.9485723732,#H164:3.27014571051::0.4154733226);
(OUTGROUP:1.0,(((t22:0.600149002,((t19:0.06518611879,(t94:0.2712337665,t65:0.06518611879):0.2060476477):0.09831177196)#H194:0.0::0.5307511118):0.2306034635,t79:0.3695455384):2.609182295,#H194:2.83978575871::0.4692488882));", "\n")]

net = readTopology("((((((t20:0.8069029778,(t9:0.6320905062,(((t60:0.2686887862,t59:0.2686887862):0.1443245409,t33:0.4130133271):0.2190771791)#H164:0.0::0.5845266774):0.1748124716):1.146760865,(t49:0.2724649979,((t56:0.04624646874,(t12:0.03071116952,t58:0.03071116952):0.01553529922):0.03055235709,t98:0.07679882582):0.1956661721):1.681198845):1.553722643,((((t93:0.1192188787,t88:0.1192188787):0.7135662172,(t61:0.4985575713,(t95:0.03097553347,t43:0.03097553347):0.4675820379):0.3342275246):0.4701991894,(((t25:0.3275492391,t82:0.3275492391):0.3285882181,t1:0.6561374572):0.424281809,(t38:0.2310500186,(t11:0.1329376313,t74:0.1329376313):0.09811238733):0.8493692476):0.2225650191):0.9275490644,(t97:0.8252488869,t5:0.8252488869):1.405284463):1.276853137):0.3948497302,(((t83:1.5106571,(t44:1.154173507,t10:1.154173507):0.3564835929):0.2171339475,t47:1.727791047):0.8060675791,(((t7:0.4012149549,((t57:0.2577377349,(t17:0.0266758688,t28:0.0266758688):0.2310618661):0.004916829693,t15:0.2626545646):0.1385603903):0.6955730723,(#H164:0.3330930011::0.4154733226,(t67:0.9401537809,(t71:0.6368969617,(t63:0.3894980428,t92:0.3894980428):0.2473989189):0.3032568192):0.02502972643):0.1316045199):1.415260914,(((t48:1.28713674)#H128:0.8509902879::0.603303879,(((t86:0.4393284171,t8:0.4393284171):0.2076416515,#H172:0.0::0.2808524149):0.744223159,(t35:0.8283249555,(t62:0.6469700686)#H172:0.1813548869::0.7191475851):0.5628682721):0.7469338003):0.2952212144,(((t76:0.1297385709,t69:0.1297385709):0.1720715546,(t87:0.2571742635,t72:0.2571742635):0.04463586193):1.234153243,((t32:0.4739880036,t46:0.4739880036):0.8131487364,#H128:0.0::0.396696121):0.2488266283):0.897384874):0.07870069866):0.02180968551):1.36837759):0.8920755276,((((t52:0.261105943,t85:0.261105943):2.417407441,((((t55:0.04061377758,t39:0.04061377758):0.7422836803,(t2:0.4670806173,(t41:0.2156929686,t66:0.2156929686):0.2513876487):0.3158168406):0.3886863712,(t13:0.002361487328,t18:0.002361487328):1.169222342):0.8837745757,((((((t53:0.1113005355,t50:0.1113005355):0.04432958978,(t31:0.117977806,t40:0.117977806):0.03765231934):0.1530258405,(t68:0.2065356603,t73:0.2065356603):0.1021203055):0.01089651029,t96:0.3195524761):0.2098794484,t34:0.5294319244):0.9579286632,t90:1.487360588):0.5679978172):0.6231549787):0.1903602078,(((((t4:0.4935476682,t80:0.4935476682):0.2757884723)#H139:0.8685467319::0.5051413627,((t14:1.023568054,(t99:0.0491435253,t51:0.0491435253):0.9744245288):0.3446913007,(((t54:0.02703292514,t75:0.02703292514):0.532576578,t84:0.5596095031):0.2097266374,#H139:0.0::0.4948586373):0.5989232143):0.2696235176):0.292385089,(((((t81:0.3695455384,#H194:0.0::0.4692488882):0.08309626603,((t27:0.1911785185,t29:0.1911785185):0.1619086624,t89:0.353087181):0.09955462346):0.389580938,t91:0.8422227425):0.07854236488,(t100:0.352200557,t24:0.352200557):0.5685645504):0.5612649503,(t26:0.2787387563,t16:0.2787387563):1.203291301):0.4482379038):0.8092194438,((((t45:0.713593169,t6:0.713593169):0.3909433556,((t77:0.6075883596,t21:0.6075883596):0.4199592114,t36:1.027547571):0.07698895362):0.8810617716,(t37:1.119341441,t23:1.119341441):0.8662568555):0.3976699498,(((t3:0.6564742276,(t78:0.02151701115,t30:0.02151701115):0.6349572164):0.006108527606,(t42:0.03840320956,t70:0.03840320956):0.6241795456):1.490719049,t64:2.153301804):0.2299664418):0.3562191594):0.129386186):0.3404577059,((t79:0.3695455384,(((t19:0.06518611879,t65:0.06518611879):0.2060476477,t94:0.2712337665):0.09831177196)#H194:0.0::0.5307511118):0.2306034635,t22:0.600149002):2.609182295):1.584980447),OUTGROUP:1.0);")

D, namelist = majorinternodedistance(net)
mnet = netnj(D, cs, namelist)


for (i, constraint) in enumerate(cs)
    D, namelist = majorinternodedistance(constraint)
    try
        netnj(D, [constraint], namelist)
    catch e
        println(i)
    end
end



# MWE
constraint = readTopology("((((t86:0.4393284171,t8:0.4393284171):0.2076416515,(t35:0.8283249555,(t62:0.6469700686)#H172:0.1813548869::0.7191475851):0.0):0.744223159,#H128:0.5628682721::0.396696121):0.2952212144,((t87:0.2571742635,t72:0.2571742635):0.04463586193,(((t32:0.4739880036,t46:0.4739880036):0.8131487364,((#H172:0.0::0.2808524149)#H128:0.8509902879::0.603303879,t48:0.7469338003):0.0):0.2488266283,(t76:0.1297385709,t69:0.1297385709):0.1720715546):1.234153243):0.897384874);")

using PhyloPlots
plot(constraints)